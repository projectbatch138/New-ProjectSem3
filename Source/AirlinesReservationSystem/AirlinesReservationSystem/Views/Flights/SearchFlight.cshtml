@model IEnumerable<AirlinesReservationSystem.Flight>

@{
    ViewBag.Title = "SearchFlight";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<pre style="background-color:white ; border:none">


</pre>
<h3>Flight Depart</h3>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Plane.PlaneName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Router.RouterName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Dept_Time)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Arr_Time)
        </th>
        @{
            List<SeatClass> seatClasses = new List<SeatClass>();
            seatClasses = ViewBag.SeatClass;
            foreach (var i in seatClasses)
            {
                <th>
                    @Html.DisplayName(i.SeatClassName)
                </th>
            }
        }
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Plane.PlaneName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Router.RouterName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Dept_Time)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Arr_Time)
        </td>
        @{
            List<Price> Price = new List<Price>();
            Price = ViewBag.Price;
            List<DiscountDetail> Discount = new List<DiscountDetail>();
            Discount = ViewBag.Discount;
            foreach (var i in seatClasses)
            {


                List<SeatDetailByFlight> seatbyflight = new List<SeatDetailByFlight>();
                seatbyflight = ViewBag.SeatClassByFlight;
                seatbyflight = seatbyflight.Where(x => x.FlightId == item.Flightid)
                    .Where(x => x.SeatStatus == true)
                    .Where(x => x.SeatNumber.SeatClass.SeatClassId == i.SeatClassId)
                    .ToList<SeatDetailByFlight>();
                List<Price> price = new List<Price>();
                price = Price.Where(x => x.FlightId == item.Flightid)
                    .Where(x => x.SeatClassId == i.SeatClassId).ToList<Price>();

                List<DiscountDetail> discount = new List<DiscountDetail>();
                discount = Discount.Where(x => x.FlightId == item.Flightid)
                    .ToList<DiscountDetail>();
        <td>
            @{
                foreach (var x in price)
                {
                    foreach (var a in discount)
                    {
                        decimal PriceTotal = (decimal)(x.Price1 - (x.Price1 * a.Discount/100));
                        <p style="color:mediumvioletred">Price: @PriceTotal.ToString()</p>
                        @Html.ActionLink(@seatbyflight.Count + " Seat left", "Booking", "Booking", new { id = item.Flightid, seatclassid = i.SeatClassId, DiscountId = a.DiscountId, PriceId = x.PriceId }, null)
                    }

                }
            }


        </td>
            }
        }

    </tr>
    }

</table>




@{
    if (ViewBag.FlightArrival != null)
    {
        List<Flight> flightArrival = new List<Flight>();
        flightArrival = ViewBag.FlightArrival;
        <h3>Flight Arrival</h3>

        <table class="table">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Plane.PlaneName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Router.RouterName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Dept_Time)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Arr_Time)
                </th>
                @{

                    foreach (var i in seatClasses)
                    {
                        <th>
                            @Html.DisplayName(i.SeatClassName)
                        </th>
                    }
                }
                <th></th>
            </tr>
            @foreach (var item in flightArrival)
            {

                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Plane.PlaneName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Router.RouterName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Dept_Time)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Arr_Time)
                    </td>

                    <td>

                        @Html.ActionLink("Booking", "Booking Ticket", new { id = item.Flightid })

                    </td>
                </tr>
            }
        </table>
    }

}


